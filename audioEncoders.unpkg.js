// This module is licensed under the MIT License and is from the following GitHub repository provided in the next sentence. https://github.com/arseneyr/wasm-media-encoders/tree/master

var e,t;e=this,t=function(){function e(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var t={mimeType:"audio/mpeg",parseParams:function(e){switch(e.bitrate){case void 0:case 8:case 16:case 24:case 32:case 40:case 48:case 64:case 80:case 96:case 112:case 128:case 160:case 192:case 224:case 256:case 320:break;default:throw Error("Invalid constant bitrate ".concat(e.bitrate))}switch(e.outputSampleRate){case void 0:case 8e3:case 11025:case 12e3:case 16e3:case 22050:case 24e3:case 32e3:case 44100:case 48e3:break;default:throw Error("Invalid output sample rate ".concat(e.outputSampleRate))}if(void 0!==e.vbrQuality&&(e.vbrQuality<0||e.vbrQuality>=10))throw Error("Invalid VBR quality: ".concat(e.vbrQuality));var t,r,a,n=new Int32Array(3);return n[0]=null!==(t=e.bitrate)&&void 0!==t?t:0,new Float32Array(n.buffer)[1]=null!==(r=e.vbrQuality)&&void 0!==r?r:void 0!==e.bitrate?-1:4,n[2]=null!==(a=e.outputSampleRate)&&void 0!==a?a:0,n}},r={mimeType:"audio/ogg",parseParams:function(e){var t,r=null!==(t=e.vbrQuality)&&void 0!==t?t:3,a=void 0!==e.oggSerialNo?Math.min(Math.max(Math.floor(e.oggSerialNo),-2147483648),2147483647):Math.floor(4294967296*Math.random())+-2147483648;if(r<-2||r>10)throw Error("Invalid VBR quality ".concat(r));var n=new Int32Array(2);return new Float32Array(n.buffer)[0]=r,n[1]=a,n}};async function a(t){var r,a,n={wasi_snapshot_preview1:{proc_exit:e=>{throw Error("fatal error exit(".concat(e,")"))}},env:{emscripten_notify_memory_growth:()=>{}}};"string"!=typeof t||WebAssembly.instantiateStreaming||(t="undefined"==typeof fetch?await function(e){var t=e.split(",");if(2!==t.length||!1===/^data:application\/(octet-stream|wasm);base64$/.test(t[0]))throw Error("Passed non-data URI");return Buffer.from(t[1],"base64")}(t):await (await fetch(t)).arrayBuffer());var o=await ("string"==typeof t?WebAssembly.instantiateStreaming(fetch(t),n):WebAssembly.instantiate(t,n)),i=(r=function(t){for(var r=1;r<arguments.length;r++){var a=null!=arguments[r]?arguments[r]:{},n=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(a).filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable}))),n.forEach(function(r){e(t,r,a[r])})}return t}({},(o.instance||o).exports),a=a={module:o.module||t,getInt32Array(e,t){return new Int32Array(this.memory.buffer,e,t)},getFloat32Array(e,t){return new Float32Array(this.memory.buffer,e,t)},getUint8Array(e,t){return new Uint8Array(this.memory.buffer,e,t)},getString(e){var t=this.getUint8Array(e),r=t.indexOf(0);return String.fromCharCode(...t.slice(0,r))}},Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(a)):(function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);r.push.apply(r,a)}return r})(Object(a)).forEach(function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(a,e))}),r);return i._initialize(),i}var n="wasm-media-encoders",o="0.7.0";function i(){return"".concat(n,"-").concat(o)}var s={[t.mimeType]:t,[r.mimeType]:r};class c{get_pcm(e){var t=this.module.enc_get_pcm(this.ref,e);if(!t)throw Error("PCM buffer allocation failed");var r=this.module.getInt32Array(t,this.channelCount);return Array.from({length:this.channelCount},(t,a)=>this.module.getFloat32Array(r[a],e))}get_out_buf(e){var t=this.module.enc_get_out_buf(this.ref);return this.module.getUint8Array(t,e)}get_common_params(e){switch(e.channels){case 1:case 2:break;default:throw Error("Invalid channel count: ".concat(e.channels,". ").concat(this.mimeType," supports 1 or 2 channels."))}if("number"!=typeof e.sampleRate)throw Error("Invalid sample rate: ".concat(e.sampleRate));return new Uint32Array([e.channels,e.sampleRate])}static async create(e,t,r){return new c(e,await a(t),s[e].parseParams,r)}configure(e){this.ref&&(this.module.enc_free(this.ref),this.ref=0);var t=this.get_common_params(e),r=this.parseParams(e),a=this.module.malloc(t.byteLength+r.byteLength);if(!a)throw Error("Failed to allocate parameter buffer");this.module.getInt32Array(a,t.length).set(t),this.module.getInt32Array(a+t.byteLength,r.length).set(r),this.channelCount=e.channels;try{if(this.ref=this.module.enc_init(a),!this.ref)throw Error("Encoder initialization failed")}finally{this.module.free(a)}}encode(e){if(e.length!==this.channelCount)throw Error("encode must be called with channel number (".concat(this.channelCount,") of Float32Arrays"));var t=this.get_pcm(e[0].length);t.forEach((t,r)=>t.set(e[r]));var r=this.module.enc_encode(this.ref,t[0].length);if(r<0)throw Error("Error while encoding: ".concat(r));return this.get_out_buf(r)}finalize(){var e=this.module.enc_flush(this.ref);if(e<0)throw Error("Error while encoding: ".concat(e));return this.get_out_buf(e)}constructor(t,r,a,n){e(this,"mimeType",void 0),e(this,"module",void 0),e(this,"parseParams",void 0),e(this,"ref",void 0),e(this,"channelCount",void 0),this.mimeType=t,this.module=r,this.parseParams=a;var o=this.module.version?this.module.getString(this.module.version()):"unknown (< 0.7.0)",i=this.module.getString(this.module.mime_type()),s=u();if(null==n||n(r.module,o,i),s!=o)throw Error("JS and WASM version mismatch. JS version: ".concat(s," WASM version: ").concat(o));if(t!=i)throw Error("Loaded incorrect WASM for MIME type. JS expected ".concat(t,", WASM is ").concat(i))}}var l=c.create,u=i,h=l.bind(null,"audio/mpeg","https://unpkg.com/".concat(n,"@").concat(o,"/wasm/mp3.wasm")),m=l.bind(null,"audio/ogg","https://unnamedbruh.github.io/newer-audio-editor/ogg.wasm");return c.createEncoder=l,c.createMp3Encoder=h,c.createOggEncoder=m,c.jsLibraryVersion=i,c},"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).WasmMediaEncoder=t();
