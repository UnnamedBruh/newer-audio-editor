<html lang="en">
	<head>
		<style id="style"></style>
	</head>
	<body>
		<h1>Clicker Game</h1>
		<p>Welcome to this simple clicker game! This is where you click the button to... uhh... earn <a id="amount">a</a> <a id="currency">click</a><a id="sornos"></a>. <a id="note2">(Yeah... it's very awkward to read it out loud, so I'm planning to change that later.)</a></p>
		<button id="button">Click me</button>
		<br>
		<a id="clicks"></a>
		<p id="note">As you can see, there's not a whole lot going on. I'll keep working on this as you and other users make progress! Take care.</p>
		<div id="upgrades"></div>
		<script>
//(async function() {
	const AOCText = document.getElementById("amount"), AOCS = document.getElementById("sornos"), button = document.getElementById("button"), currency = document.getElementById("currency"), numOfClicks = document.getElementById("clicks"), upgrades = document.getElementById("upgrades"), note = document.getElementById("note"), note2 = document.getElementById("note2");
	let clicks = 0, cl = 1;
	const thingsToTrigger = [function() {}];
	let state = 0;
	let bitwiseIntegers = [0b00000011, 0, 0, 0];
	const numberWords = ["zero", "a", "two", "three", "four", "five", "six", "seven", "eight", "nine", "ten", "eleven", "twelve", "thirteen", "fourteen", "fifteen", "sixteen", "seventeen", "eighteen", "nineteen", "twenty"];
	const upgradesElements = [];
	let alertFor = {notEnoughPresses: true};
	function n() {return document.body.appendChild(document.createElement("br"))}
	async function alertBox(textD) {
		if (alertFor.polishedAlert) {
			const box = document.createElement("div");
			box.style = "position: absolute; left: calc(50vw - 200px); top: calc(50vh - 100px); width: 400px; height: 200px; border: 2px black solid; box-sizing: border-box; background-color: white;";
			const text = document.createElement("a");
			text.style = "white-space: pre-wrap; word-wrap: break-word;";
			text.textContent = textD;
			document.body.appendChild(box);
			box.appendChild(text);
			box.appendChild(document.createElement("br"));
			const OK = document.createElement("button");
			OK.textContent = "OK";
			box.appendChild(OK);
			return new Promise(function(resolve, reject) {
				setTimeout(function() {
					function e(event) {if (!event || !event.target || !box.contains(event.target)) {document.body.removeEventListener("click", e);box.remove();resolve();}}
					OK.onclick = function(event) {event.stopPropagation();e();}
					document.body.addEventListener("click", e);
				}, 100);
			});
		} else alert(textD);
	}
	function setupUpgrade(obj) {
		obj.element.onclick = async function() {
			if (clicks >= obj.cost) {clicks -= obj.cost; obj.buy(obj);} else {
				if (alertFor.notEnoughPresses) await alertBox("You do not have enough presses to afford this upgrade. You need " + Math.abs(obj.cost - Math.round(clicks)).toFixed(0) + " more to do that.");
				if ((bitwiseIntegers[0] & 0b00000010) && !(bitwiseIntegers[0] & 0b00000100)) {
					bitwiseIntegers[0] |= 0b00000100;
					addUpgradeButton({cost: 6, buy: function(obj) {
						if (bitwiseIntegers[0] & 0b00000010) bitwiseIntegers[0] ^= 0b00000010;
						alertFor.notEnoughPresses = false;
						n();
						const text = document.createElement("a");
						text.textContent = "Alert when presses are not enough: ";
						document.body.appendChild(text);
						const check = document.createElement("input");
						check.type = "checkbox";
						check.oninput = function() {alertFor.notEnoughPresses = check.checked}
						document.body.appendChild(check);
						obj.unregister();
					}}, "Add not-enough alert setting (costs 6 presses)");
					addUpgradeButton({cost: 30, buy: function(obj) {
						if (bitwiseIntegers[0] & 0b00000010) bitwiseIntegers[0] ^= 0b00000010;
						alertFor.polishedAlert = true;
						obj.unregister();
					}}, "Polish alert message box (costs 30 presses)");
				}
			}
		}
		return obj;
	}
	function updateClicksText() {
		numOfClicks.textContent = (bitwiseIntegers[0] & 0b00000001 ? "Number of clicks: " : "Number of presses: ") + Math.round(clicks).toFixed(0);
	}
	function addUpgradeButton(obj, text) {
		let line = null;
		if (upgradesElements.length) line = upgrades.appendChild(document.createElement("br"));
		const upgradeButton = document.createElement("button");
		upgrades.appendChild(upgradeButton);
		upgradeButton.textContent = text;
		obj.element = upgradeButton;
		obj.unregister = function() {
			upgradeButton.remove();
			if (line) line.remove();
		}
		upgradesElements.push(setupUpgrade(obj));
	}
	function updateState() {
		switch (state) {
			case 0: {
				if (clicks > 10 && bitwiseIntegers[0] & 1) {
					bitwiseIntegers[0] ^= 0b00000001;
					state = 1;
					addUpgradeButton({cost: 10, buy: function(obj) {
						obj.cost = Math.round(obj.cost * 1.2);
						obj.element.textContent = "+1 press per click (costs " + obj.cost + " presses)";
						cl++;
						AOCText.textContent = numberWords[cl] || cl;
						AOCS.textContent = "es";
						updateClicksText();
					}}, "+1 press per click (costs 10 presses)");
					currency.textContent = "press";
					note2.textContent = "That's less awkward than before.";
					note.textContent = "But... upgrades? Wait, I don't recall adding that as an in-game feature. My game better not be sentient or... self-modifying.";
				}
			}
		}
	}
	button.onclick = function() {
		clicks += cl;
		updateClicksText();
		updateState();
	}
//})();
		</script>
	</body>
</html>
